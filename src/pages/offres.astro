---
import Layout from "../layouts/Layout.astro";
import Offrecard from "../components/Offrecard.astro";

const offres = [
    {
        adresse: "2821 Lake Sevilla, Palm Harbor, TX",
        favori: true,
        id: "64l3n8nar836i5j",
        nbChambres: 4,
        nbSdb: 2,
        nomMaison: "Beverly Springfield",
        prix: 2700,
        surface: 45,
        imgUrl: "image1.png",
    },
    {
        adresse: "2699 Green Valley, Highland Lake",
        favori: true,
        id: "lo831zeg10hpm9y",
        nbChambres: 4,
        nbSdb: 2,
        nomMaison: "Palm Harbor",
        prix: 2095,
        surface: 42,
        imgUrl: "image2.png",
    },
    {
        adresse: "909 Woodland St, Michigan, IN",
        favori: false,
        id: "s1zuhj19x8eb242",
        nbChambres: 4,
        nbSdb: 3,
        nomMaison: "Faulkner Ave",
        prix: 4550,
        surface: 80,
        imgUrl: "image3.png",
    },
];
---

<Layout titre="Offres">
    <h1>Offres</h1>

    <button id="favori-button" class="bg-indigo-800 rounded-lg text-white p-2">
        Afficher les favoris
    </button>

    <div class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {
            offres.map((offre) => (
                <div class="offre" data-favori={offre.favori.toString()}>
                    <Offrecard offre={offre} />
                </div>
            ))
        }
    </div>
</Layout>

<script>
    // Bouton "Afficher les favoris"
    const button = document.getElementById("favori-button");
    let showOnlyFavorites = false;

    button?.addEventListener("click", () => {
        showOnlyFavorites = !showOnlyFavorites;
        const offres = document.querySelectorAll(".offre");

        offres.forEach((offre) => {
            const isFavori = offre.dataset.favori === "true";

            if (showOnlyFavorites) {
                offre.style.display = isFavori ? "block" : "none";
                button.textContent = "Afficher tout";
            } else {
                offre.style.display = "block";
                button.textContent = "Afficher les favoris";
            }
        });
    });

    const cards = document.querySelectorAll(".offre-card");

    cards.forEach((card) => {
        const toggle = card.querySelector(".favori-toggle");

        toggle.addEventListener("click", (e) => {
            e.stopPropagation();

            const isFavori = card.dataset.favori === "true";
            card.dataset.favori = isFavori ? "false" : "true";

            // Fond de la card
            card.classList.toggle("bg-indigo-100");
            card.classList.toggle("bg-gray-100");

            // Bouton Favori
            toggle.textContent = isFavori ? "Standard" : "Favori";
            toggle.classList.toggle("bg-indigo-800");
            toggle.classList.toggle("text-white");
            toggle.classList.toggle("bg-slate-200");
            toggle.classList.toggle("text-indigo-950");

            const wrapper = card.closest(".offre");
            if (wrapper) wrapper.dataset.favori = card.dataset.favori;

            if (showOnlyFavorites && wrapper) {
                wrapper.style.display =
                    card.dataset.favori === "true" ? "block" : "none";
            }
        });
    });
</script>
